---
layout: nodes.liquid
section: ethereum
date: Last Modified
title: 'Ad-hoc Method'
permalink: 'docs/vrf/v2/ad-hoc/'
whatsnext:
  {
    'Get a Random Number': '/docs/vrf/v2/ad-hoc/get-a-random-number/',
    'Configuration': '/docs/vrf/v2/ad-hoc/configuration/',
  }
metadata:
  title: 'Generate Random Numbers for Smart Contracts using Chainlink VRF v2 - Ad-hoc method'
  description: 'Learn how to securely generate random numbers for your smart contract with Chainlink VRF v2(an RNG). This guide uses the ad-hoc method.'
---

> ℹ️ You are viewing the VRF v2 guide.
>
> If you are using v1, see the [VRF v1 guide](/docs/vrf/v1/introduction/).

**Table of contents**

- [Concepts](#concepts)
  - [VRF Ad-hoc](#vrf-ad-hoc)
  - [Request and Receive Data](#request-and-receive-data)
    - [End To End Diagram](#end-to-end-diagram)
    - [Explanation](#explanation)
  - [Limits](#limits)

This section explains how to generate random numbers using the ad-hoc method. This method doesn't require managing subscriptions and is more suited to one-off requests for randomness. To use the subscription method instead, see the [Subscription Method](/docs/vrf/v2/subscription/) guide.

## Concepts

### VRF Ad-hoc

The VRF Wrapper provides an interface for consuming contracts, abstracting the VRF v2 Coordinator. Contrary to the [subscription method](/docs/vrf/v2/subscription/), users do not need to create subscriptions and pre-fund them: In fact, with the ad-hoc method, users have to directly fund their consuming contracts with LINK tokens before requesting for randomness.

For Chainlink VRF v2 to fulfill your requests, you must have a sufficient amount of LINK in your consuming contract. Gas cost calculation includes the following variables:

- **Gas price:** The current gas price, which fluctuates depending on network conditions.

- **Callback gas:** The amount of gas used for the callback request that returns your requested random values.

- **Verification gas:** The amount of gas used to verify randomness on-chain.

- **Wrapper overhead gas:** The amount of gas used by the VRF Wrapper contract.

These variables depend on current network conditions, your specified limit on callback gas, and the number of random values in your request. You define the limits you are willing to spend for the request with the following variable:

- **Callback gas limit:** Specifies the maximum amount of gas you are willing to spend on the callback request. Define this limit by specifying the `callbackGasLimit` value in your request.

> ℹ️ Note on gas costs.
>
> Because the consuming contract directly pays for LINK, The cost is calculated during the request and not when the randomness is fulfilled (during the callback).
> It is strongly recommended to test several times your callback function and correctly estimate the callback gas limit. In fact:
>
> - If the gas limit is underestimated: the callback will fail but your consuming contract is still charged for the work done to generate the requested random values.
> - If the gas limit is overestimated: the callback function will be executed but you won't get refunded for the excess gas amount that you paid.

### Request and Receive Data

#### End To End Diagram

![Vrf v2 ad-hoc method end to end diagram](/images/vrf/v2-ad-hoc-e2e.png)

Two types of accounts exist in the Ethereum ecosystem:

- EOA (Externally Owned Account): an externally owned account has a private key and can control a smart contract. Transactions can only be intiated by EOAs.
- Smart contract: a smart contract does not have a private key and executes what it has been designed for as a decentralized application.

The Chainlink VRF v2 solution utilizes both off-chain and on-chain components:

- [VRF v2 Wrapper (on-chain component)](https://github.com/smartcontractkit/chainlink/blob/develop/contracts/src/v0.8/VRFV2Wrapper.sol): a wrapper for the VRF Coordinator that provides an interface for consuming contracts.
- [VRF v2 Coordinator (on-chain component)](https://github.com/smartcontractkit/chainlink/blob/develop/contracts/src/v0.8/VRFCoordinatorV2.sol): designed to interact with the VRF node. It emits an event when a request for randomness is made then verifies the random number and proof on how it was generated by the VRF Node.
- VRF Node (off-chain component): Listens for requests by subscribing to the VRF Coordinator event logs and calculates a random number based on the block hash and nonce. The node then sends a transaction to the VRFCoordinator including the random number and a proof on how it was generated.

#### Explanation

Requests to Chainlink VRF v2 follow the [Request & Receive Data](/docs/request-and-receive-data/) cycle. The VRF wrapper calls the coordinator to process the request using the following steps:

1. The consuming contract must inherit [VRFV2WrapperConsumerBase](https://github.com/smartcontractkit/chainlink/blob/develop/contracts/src/v0.8/VRFV2WrapperConsumerBase.sol) and implement the `fulfillRandomWords` function, which is the _callback VRF function_. Submit your VRF request by calling `requestRandomness`, defined in the [VRFV2WrapperConsumerBase](https://github.com/smartcontractkit/chainlink/blob/develop/contracts/src/v0.8/VRFV2WrapperConsumerBase.sol) with:

- `requestConfirmations`: The number of block confirmations the oracle node will wait to respond. The minimum and maximum confirmations for your network can be found [here](/docs/vrf/v2/ad-hoc/configuration/#configurations).
- `callbackGasLimit`: The maximum amount of gas a user is willing to pay for completing the callback VRF function.
- `numWords`: The number of random numbers to request. The maximum random values that can be requested for your network can be found [here](/docs/vrf/v2/ad-hoc/configuration/#configurations).

2. The consuming contract calls the [VRFV2Wrapper](https://github.com/smartcontractkit/chainlink/blob/develop/contracts/src/v0.8/VRFV2Wrapper.sol) `calculateRequestPrice` function to estimate the total transaction cost to fulfill randomness and then calls [LinkToken](https://github.com/smartcontractkit/chainlink/blob/develop/contracts/src/v0.4/LinkToken.sol) `transferAndCall` function to pay the wrapper with the calculated request price. This methods sends LINK tokens and executes [VRFV2Wrapper](https://github.com/smartcontractkit/chainlink/blob/develop/contracts/src/v0.8/VRFV2Wrapper.sol) `onTokenTransfer` logic. This triggers the VRF [VRF Coordinator](https://github.com/smartcontractkit/chainlink/blob/develop/contracts/src/v0.8/VRFCoordinatorV2.sol) `requestRandomWords` function to request randomness.
   The final gas cost to fulfill randomness is estimated based on how much gas is expected for the verification and callback. The total gas cost in wei uses the following formula:

   ```
   (Gas price * (Verification gas + Callback gas limit + Wrapper gas Overhead)) = total gas cost
   ```

   The total gas cost is converted to LINK using the ETH/LINK data feed. In the unlikely event that the data feed is unavailable, the VRF Wrapper uses the `fallbackWeiPerUnitLink` value for the conversion instead. The `fallbackWeiPerUnitLink` value is defined in the [VRF v2 Wrapper contract](/docs/vrf/v2/ad-hoc/configuration/#configurations) for your selected network.

   A LINK premium is then added to the total gas cost. The premium is divided in 2 parts:

   - Wrapper premium: premium ratio in percentage. The premium percentage for your network can be found [here](/docs/vrf/v2/ad-hoc/configuration/#configurations).
   - Coordinator premium: flat fee. The premium is defined in the with the `fulfillmentFlatFeeLinkPPMTier1` parameter in millionths of LINK. The flat fee of the coordinator for your network can be found [here](/docs/vrf/v2/ad-hoc/configuration/#configurations).

   ```
   ((total gas cost * Wrapper premium) + Coordinator premium) = total request cost
   ```

3. The VRF Wrapper VRF coordinator emits an event.

4. The event is picked up by the VRF node and will wait for the specified number of block confirmations to respond back to the VRF coordinator with the random values and a proof.

5. The VRF coordinator verifies the proof on-chain then calls back the Wrapper contract `fulfillRandomWords` function.

6. Finally the VRF Wrapper calls back your consuming contract.

### Limits

You can see the configuration for each network on the [Configuration](/docs/vrf/v2/ad-hoc/configuration/) page. You can also view the full configuration for each VRF v2 Wrapper contract directly in Etherscan. As an example, view the [Ethereum Mainnet VRF v2 Wrapper contract](https://etherscan.io/address/0x685fCaf489C2FE2e289a68Bc10AA94F88A83E655#readContract) configuration by calling `getConfig` function.

- Each wrapper has a `MAX_NUM_WORDS` parameter that limits the maximum number of random values you can receive in each request.

> ℹ️ Note on maximum gas limit.
>
> The maximum allowed `callbackGasLimit` value for your requests is defined in the [Coordinator contract configuration](/docs/vrf/v2/subscription/configuration/). Because the VRF v2 Wrapper adds an overhead, your `callbackGasLimit` must not exceed `maxGasLimit - wrapperGasOverhead`.
